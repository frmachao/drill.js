# 基础使用

## 如何使用 drill.js

将 drill.js的主体js文件引入；

`index.html`

```html
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>base use</title>
    <script src="js/drill.js"></script>
</head>

<body>
</body>

</html>
```

## 开始使用

目录结构:

* index.html
* js/
    * drill.js
    * a.js


`index.html`↓

```html
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>01</title>
    <script src="js/drill.js"></script>
</head>

<body>
    <script>
        require('js/a');
    </script>
</body>

</html>
```

`a.js`↓

```javascript
(function(){
    console.log('I am a.js');
})();
```

控制台的结果是

```
I am a.js
```

解释：

`require` 函数将 `js/a.js` 的文件引用，；

drill.js 会自动补齐 `.js` 后缀（加上`.js`后缀也没关系）；

当重复 `require` 引用同一文件，那个文件不会被重复载入，只会载入一次；

例如我们改动 `index.html`

```html
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>01-2</title>
    <script src="js/drill.js"></script>
</head>

<body>
    <script>
        require('js/a');
        
        require('js/a');

        setTimeout(()=>{
            require('js/a');
        },1000);
    </script>
</body>

</html>
```


控制台的结果还是一样

```
I am a.js
```

`js/a.js` 只会被载入一次，不会因为重复的使用 `require` 函数而被重复载入；

到目前阶段，你可以理解 `drill.js` 是 **文件载入器**；

## 完成后操作

案例结构同上

require函数运行后返回的是一个 [Promise](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise) 对象，加载文件完成后进入 `fulfilled` 状态，使用如下:

`index.html`

```html
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>01-3</title>
    <script src="js/drill.js"></script>
</head>

<body>
    <script>
        require('js/a').then(()=>{
            console.log('run ok');
        })
    </script>
</body>

</html>
```

控制台的结果

```
I am a.js
run ok
```

通常情况下，会使用 `await` 优化代码；

`index.html`

```html
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>01-4</title>
    <script src="js/drill.js"></script>
</head>

<body>
    <script>
    (async ()=>{
        await require('js/a');
        console.log('run ok');
    })();
    </script>
</body>

</html>
```

控制台结果同上；

```
I am a.js
run ok
```

## 模块化

目录结构:

* index.html
* js/
    * drill.js
    * d1.js
    * d2.js

`d1.js`↓

```javascript
define({
    val:"I am d1.js"
});
```

`d2.js`↓

```javascript
define(async (require) => {
    let d1 = await require('js/d1');

    return {
        val: "I am d2.js",
        d1_val: d1.val
    };
});
```

`index.html`↓

```html
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>01-5</title>
    <script src="js/drill.js"></script>
</head>

<body>
    <script>
    (async ()=>{
        let d1 = await require('js/d1');

        console.log(d1.val);

        let d2 = await require('js/d2');

        console.log(d2.val);

        console.log(d1.val === d2.d1_val);
    })();
    </script>
</body>

</html>
```

控制台结果:

```
I am d1.js
I am d2.js
true
```