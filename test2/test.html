<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>test2</title>
    <script src="../src/drill.js" drill-cache="22"></script>
</head>

<body>
    <script>
        drill = async (drill) => {
            drill.config({
                baseUrl: "js/",
                paths: {
                    aa: "dir1/d1",
                    'a/': "dir1/"
                }
            });

            // drill.onerror = (err)=>{
            //     debugger
            // }

            // 模拟扩展
            drill.ext('fixUrlObj', ([...arg], next) => {
                let reobj = next(...arg);
                console.log(reobj);
                return reobj;
            });

            // 模拟扩展
            drill.ext('load', ([...arg], next) => {
                let reobj = next(...arg);
                return reobj;
            });

            // 模拟扩展
            drill.ext('agent', ([...arg], next) => {
                let reobj = next(...arg);
                return reobj;
            });

            load('a?a=a1&b=b1', 'b.js', 'c', 'd')
                .pend(data => {
                    console.log('pend => ', data);
                })
                .then(([a, b, c, d]) => {
                    console.log('end', a, b, c, d);
                });
            // load('c')
            //     .pend(data => {
            //         console.log('pend2 => ', data);
            //     })
            //     .then((c) => {
            //         console.log('c的值是=>', c);
            //     });


            // setTimeout(async () => {
            //     let data = await load('d').post({
            //         // let data = await load('js/d -r').post({
            //         pp: "I am post data"
            //     });

            //     console.log('after task => ', data);
            // }, 100);


            // drill.loaders.min = async (urlData) => {
            //     debugger
            //     return {
            //         stat: 1,
            //         o: {
            //             async get() {
            //                 return await new Promise(res => {
            //                     setTimeout(() => {
            //                         res(100000);
            //                     }, 1000);
            //                 });
            //             }
            //         }
            //     };
            // };


            // let [d1, jsondata] = await load('dir1/d1', 'test.json');
            // console.log('d1 => ', d1, '  test.json => ', jsondata);

            // let d1 = await load('aa');
            // let d1 = await load('a/d1');
        }
    </script>
</body>

</html>