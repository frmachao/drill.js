/*!
* drill.js v3.3.2
* https://github.com/kirakiray/drill.js
* 
* (c) 2018-2020 YAO
* Released under the MIT License.
*/(e=>{"use strict";const t=new Map,a=new Map,r=new Map,s=new Map,n={};let l={time:100,backups:[]},i={processors:t,loaders:a,bag:r,paths:s,dirpaths:n,errInfo:l,baseUrl:"",tempM:{}};const o=()=>Math.random().toString(32).substr(2);var c=Object.prototype.toString;const p=e=>(e=>c.call(e).toLowerCase().replace(/(\[object )|(])/g,""))(e).search("function")>-1;const d=(()=>{let e=!1,t=[];return a=>{e||(e=!0,setTimeout(()=>{for(let e=0;e<t.length;e++)t[e]();t=[],e=!1},0)),t.push(a)}})(),u=e=>{let t=e.match(/(.+\/).*/);return t&&t[1]},h=e=>{let t=[];return e.split(/\//g).forEach(e=>{".."==e&&t.length&&".."!=t.slice(-1)[0]?t.pop():t.push(e)}),t.join("/")},m=u(document.location.href);a.set("css",e=>new Promise((t,a)=>{let r=document.createElement("link");r.rel="stylesheet",r.href=e.link,r.onload=(()=>{t()}),r.onerror=(()=>{a()}),document.head.appendChild(r)})),a.set("json",async e=>{let t=await fetch(e.link);return t=await t.json(),async()=>t}),a.set("wasm",async e=>{let t=await fetch(e.link);t=await t.arrayBuffer();let a=await WebAssembly.compile(t);const r=new WebAssembly.Instance(a);return async()=>r.exports}),a.set("frame",async e=>{let t=document.createElement("iframe");Object.assign(t.style,{position:"absolute","z-index":"-1",border:"none",outline:"none",opacity:"0",width:"0",height:"0"});let{link:a,path:s}=e,n=s.replace(/\.frame$/,"/frame.html"),l=a.replace(s,n);t.src=l;let i=new Map,c=()=>{r.delete(s),document.body.removeChild(t),window.removeEventListener("message",p),p=e=c=null};e.timer=setTimeout(c,1e4);let p,d=a=>new Promise(r=>{let s=o();clearTimeout(e.timer),i.set(s,{res:r}),t.contentWindow.postMessage({type:"drillFrameTask",taskId:s,data:a.data},"*")});return window.addEventListener("message",p=(t=>{let{data:a,taskId:r}=t.data;if(i.has(r)){let e=i.get(r);i.delete(r),e.res(a)}i.size||(e.timer=setTimeout(c,1e4))})),new Promise((e,a)=>{t.addEventListener("load",t=>{e(d)}),t.addEventListener("error",e=>{c(),a()}),document.body.appendChild(t)})}),a.set("js",e=>new Promise((a,s)=>{let n=document.createElement("script");n.type="text/javascript",n.async=!0,n.src=e.link,n.addEventListener("load",async()=>{let s,{tempM:n}=i,{type:l,moduleId:o}=n;o&&(r.get(o)||r.set(o,e));let c=t.get(l||"file");if(!c)throw"no such this processor => "+l;s=await c(e),i.tempM={},a(s)}),n.addEventListener("error",()=>{s()}),document.head.appendChild(n)}));const f=e=>{let t=a.get(e);return t||(console.log("no such this loader => "+e),t=b),t},b=async e=>{let t;try{t=await fetch(e.link)}catch(t){return void(e.stat=2)}t=await t.text(),e.getPack=(async()=>t),e.stat=3},g=e=>/^http/.test(e);let w=async e=>{let t=r.get(e.path);if(!t)for((t={stat:1,dir:e.dir,path:e.path,link:e.link,fileType:e.fileType}).passPromise=new Promise((e,a)=>{t._passResolve=e,t._passReject=a}),r.set(e.path,t);;)try{t.getPack=await f(e.fileType)(t)||(async()=>{}),t.stat=3,t._passResolve();break}catch(a){if(t.stat=2,g(e.str))break;let{backups:r}=l;if(r.length){let e=void 0!=t.backupId?t.backupId:t.backupId=-1;if(!(e<r.length))break;{let a=r[e]||i.baseUrl,s=location.href.replace(/(.+\/).+/,"$1");g(a)||(a=s+a);let n=r[e=++t.backupId];if(!n){t.stat=4,t._passReject();break}g(n)||(n=s+n),t.link=t.link.replace(new RegExp("^"+a),n),await new Promise(e=>setTimeout(e,l.time))}}}return await t.passPromise,await t.getPack(e)};const k={load:(...e)=>v(I(e)),remove(e){let{path:t}=j({str:e});if(r.has(t))return r.delete(t),!0;console.warn(`pack %c${e}`,"color:red","does not exist")},has(e){let{path:t}=j({str:e}),a=r.get(t);return a&&a.stat},config(e){e.baseUrl&&(i.baseUrl=e.baseUrl);let t=e.paths;t&&Object.keys(t).forEach(e=>{/\/$/.test(e)?n[e]={reg:new RegExp("^"+e),value:t[e]}:s.set(e,t[e])}),i.baseUrl&&e.backups&&e.backups.forEach(e=>l.backups.push(e))},ext(e,t){if(p(e))e(i);else{let a,r=(...e)=>t(e,a,i);switch(e){case"fixUrlObj":a=j,j=r;break;case"load":a=v,v=r;break;case"agent":a=w,w=r}}},cacheInfo:{k:"d_ver",v:""},debug:{bag:r},version:"3.3.2",v:3003002};let y=(a,r)=>{t.set(a,async e=>await r(e,i.tempM.d));let s=(e,t)=>{i.tempM={type:a,d:e,moduleId:t}};k[a]||(k[a]=s),e[a]||(e[a]=s)},v=e=>{let t,a=new Promise((a,r)=>{let s=[],{length:n}=e,l=n,i=[];e.forEach(async(e,o)=>{let c,p="succeed";e.param&&e.param.includes("-getPath")?c=e.link:(await new Promise(e=>d(e)),c=await w(e).catch(t=>{p="error",Object.assign(e,{type:"error",descript:t}),i.push(e)})),s[o]=c,t&&t({id:o,sum:l,ready:l-n+1,stat:p}),--n||(i.length?r(i):a(1==l?c:s),s=null)})});return a.post=function(t){return e.forEach(e=>e.data=t),this},a.pend=function(e){return t=e,this},a},j=e=>{let{str:t}=e;if(r.has(t)){let a=r.get(t);return Object.assign(e,{path:a.path,link:a.link,dir:a.dir}),e}let a=t.split(/\s/).filter(e=>e&&e),l=a.slice(1),o=a[0],c=o.match(/(.+)\?(\S+)$/)||"";c&&(o=c[1],c=c[2]);let{k:p,v:d}=k.cacheInfo;p&&d&&(c&&(c+="&"),c+=p+"="+d);let f=s.get(o);if(f)o=f;else for(let e in n){let t=n[e];if(t.reg.test(o)){o=o.replace(t.reg,t.value);break}}let b,g=(e=>{let t,a=e.split("/").pop().match(/(.+)\.(.+)/);return a&&(t=a[2]),t})(o)||"js";if(o=o.replace(new RegExp("\\."+g+"$"),""),b=l.indexOf("-r")>-1||/^.+:\/\//.test(o)?o:/^\./.test(o)?e.relative?o=e.relative+o:o.replace(/^\.\//,""):i.baseUrl+o,l.includes("-pack")){let e=b.match(/(.+)\/(.+)/);o=b=e&&2 in e?e[1]+"/"+e[2]+"/"+e[2]:`${b}/${b}`}/^.+:\/\//.test(b)||(b=m+b),b=b.replace(/\/\.\//,"/"),o=o.replace(/\/\.\//,"/"),/\.\.\//.test(b)&&(b=h(b),o=h(o));let w=u(b+="."+g),y=c?b+"?"+c:b;return Object.assign(e,{link:y,search:c,ori:o,fileType:g,path:b,dir:w,param:l}),e};const I=(e,t)=>{let a=o();return e.map((e,r)=>j({loadId:o(),id:r,str:e,groupId:a,relative:t}))};t.set("file",e=>{}),y("define",async(e,t)=>{let a={},r={exports:a};if(p(t)){let{path:s,dir:n}=e;t=t((...e)=>v(I(e,n)),a,r,{FILE:s,DIR:n})}return t instanceof Promise&&(t=await t),t||(e=>!(0 in Object.keys(e)))(r.exports)||(t=r.exports),async()=>t}),y("task",(e,t)=>{if(!p(t))throw"task must be a function";let{path:a,dir:r}=e;return async e=>{return await t((...e)=>v(I(e,r)),e.data,{FILE:a,DIR:r})}}),y("init",(e,t)=>{if(!p(t))throw"init must be a function";let a,{path:r,dir:s}=e,n=0;return async e=>n?a:(a=await t((...e)=>v(I(e,s)),e.data,{FILE:r,DIR:s}),n=1,a)});let E={get agent(){return w},get load(){return v},get fixUrlObj(){return j},get toUrlObjs(){return I},get setProcessor(){return y}};Object.defineProperty(i,"main",{value:E}),e.load||(e.load=k.load);let P=document.currentScript;if(!P&&(P=document.querySelector(["drill-cache"])),P){let e=P.getAttribute("drill-cache");e&&(k.cacheInfo.v=e)}let x=e.drill;Object.defineProperty(e,"drill",{get:()=>k,set(e){p(e)?d(()=>e(k)):console.error("drill type error =>",e)}}),x&&d(()=>x(k))})(window);