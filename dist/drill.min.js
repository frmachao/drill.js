/*!
* drill.js v3.3.1
* https://github.com/kirakiray/drill.js
* 
* (c) 2018-2020 YAO
* Released under the MIT License.
*/(e=>{"use strict";const t=new Map,a=new Map,r=new Map,s=new Map,n={};let l={time:100,backups:[]},i={processors:t,loaders:a,bag:r,paths:s,dirpaths:n,errInfo:l,baseUrl:"",tempM:{}};const c=()=>Math.random().toString(32).substr(2);var o=Object.prototype.toString;const d=e=>(e=>o.call(e).toLowerCase().replace(/(\[object )|(])/g,""))(e).search("function")>-1;const p=(()=>{let e=!1,t=[];return a=>{e||(e=!0,setTimeout(()=>{for(let e=0;e<t.length;e++)t[e]();t=[],e=!1},0)),t.push(a)}})(),u=e=>{let t=e.match(/(.+\/).*/);return t&&t[1]},h=e=>{let t=[];return e.split(/\//g).forEach(e=>{".."==e&&t.length&&".."!=t.slice(-1)[0]?t.pop():t.push(e)}),t.join("/")},m=u(document.location.href);a.set("css",e=>new Promise((t,a)=>{let r=document.createElement("link");r.rel="stylesheet",r.href=e.link,r.onload=(()=>{t()}),r.onerror=(()=>{a()}),document.head.appendChild(r)})),a.set("json",async e=>{let t=await fetch(e.link);return t=await t.json(),async()=>t}),a.set("wasm",async e=>{let t=await fetch(e.link);t=await t.arrayBuffer();let a=await WebAssembly.compile(t);const r=new WebAssembly.Instance(a);return async()=>r.exports}),a.set("frame",async e=>{let t=document.createElement("iframe");Object.assign(t.style,{position:"absolute","z-index":"-1",border:"none",outline:"none",opacity:"0",width:"0",height:"0"});let{link:a,path:s}=e,n=s.replace(/\.frame$/,"/frame.html"),l=a.replace(s,n);t.src=l;let i=new Map,o=()=>{r.delete(s),document.body.removeChild(t),window.removeEventListener("message",d),d=e=o=null};e.timer=setTimeout(o,1e4);let d,p=a=>new Promise(r=>{let s=c();clearTimeout(e.timer),i.set(s,{res:r}),t.contentWindow.postMessage({type:"drillFrameTask",taskId:s,data:a.data},"*")});return window.addEventListener("message",d=(t=>{let{data:a,taskId:r}=t.data;if(i.has(r)){let e=i.get(r);i.delete(r),e.res(a)}i.size||(e.timer=setTimeout(o,1e4))})),new Promise((e,a)=>{t.addEventListener("load",t=>{e(p)}),t.addEventListener("error",e=>{o(),a()}),document.body.appendChild(t)})}),a.set("js",e=>new Promise((a,s)=>{let n=document.createElement("script");n.type="text/javascript",n.async=!0,n.src=e.link,n.addEventListener("load",async()=>{let s,{tempM:n}=i,{type:l,moduleId:c}=n;c&&(r.get(c)||r.set(c,e));let o=t.get(l||"file");if(!o)throw"no such this processor => "+l;s=await o(e),i.tempM={},a(s)}),n.addEventListener("error",()=>{s()}),document.head.appendChild(n)}));const f=e=>{let t=a.get(e);return t||(console.log("no such this loader => "+e),t=b),t},b=async e=>{let t;try{t=await fetch(e.link)}catch(t){return void(e.stat=2)}t=await t.text(),e.getPack=(async()=>t),e.stat=3},g=e=>/^http/.test(e);let w=async e=>{let t=r.get(e.path);if(!t)for(t={stat:1,dir:e.dir,path:e.path,link:e.link,fileType:e.fileType},r.set(e.path,t);;)try{t.getPack=await f(e.fileType)(t)||(async()=>{});break}catch(a){if(g(e.str))break;let{backups:r}=l;if(r.length){let e=void 0!=t.backupId?t.backupId:t.backupId=-1;if(!(e<r.length))break;{let a=r[e]||i.baseUrl,s=location.href.replace(/(.+\/).+/,"$1");g(a)||(a=s+a);let n=r[e=++t.backupId];if(!n)break;g(n)||(n=s+n),t.link=t.link.replace(new RegExp("^"+a),n),await new Promise(e=>setTimeout(e,l.time))}}}return await t.getPack(e)};const k={load:(...e)=>v(E(e)),remove(e){let{path:t}=I({str:e});if(r.has(t))return r.delete(t),!0;console.warn(`pack %c${e}`,"color:red","does not exist")},has(e){let{path:t}=I({str:e}),a=r.get(t);return a&&a.stat},config(e){e.baseUrl&&(i.baseUrl=e.baseUrl);let t=e.paths;t&&Object.keys(t).forEach(e=>{/\/$/.test(e)?n[e]={reg:new RegExp("^"+e),value:t[e]}:s.set(e,t[e])}),i.baseUrl&&e.backups&&e.backups.forEach(e=>l.backups.push(e))},ext(e,t){if(d(e))e(i);else{let a,r=(...e)=>t(e,a,i);switch(e){case"fixUrlObj":a=I,I=r;break;case"load":a=v,v=r;break;case"agent":a=w,w=r}}},cacheInfo:{k:"d_ver",v:""},debug:{bag:r},version:"3.3.1",v:3003001};let y=(a,r)=>{t.set(a,async e=>await r(e,i.tempM.d));let s=(e,t)=>{i.tempM={type:a,d:e,moduleId:t}};k[a]||(k[a]=s),e[a]||(e[a]=s)},v=e=>{let t,a=new Promise((a,r)=>{let s=[],{length:n}=e,l=n,i=[];e.forEach(async(e,c)=>{let o,d="succeed";e.param&&e.param.includes("-getPath")?o=e.link:(await new Promise(e=>p(e)),o=await w(e).catch(t=>{d="error",Object.assign(e,{type:"error",descript:t}),i.push(e)})),s[c]=o,t&&t({id:c,sum:l,ready:l-n+1,stat:d}),--n||(i.length?r(i):a(1==l?o:s),s=null)})});return a.post=function(t){return e.forEach(e=>e.data=t),this},a.pend=function(e){return t=e,this},a},I=e=>{let{str:t}=e;if(r.has(t)){let a=r.get(t);return Object.assign(e,{path:a.path,link:a.link,dir:a.dir}),e}let a=t.split(/\s/).filter(e=>e&&e),l=a.slice(1),c=a[0],o=c.match(/(.+)\?(\S+)$/)||"";o&&(c=o[1],o=o[2]);let{k:d,v:p}=k.cacheInfo;d&&p&&(o&&(o+="&"),o+=d+"="+p);let f=s.get(c);if(f)c=f;else for(let e in n){let t=n[e];if(t.reg.test(c)){c=c.replace(t.reg,t.value);break}}let b,g=(e=>{let t,a=e.split("/").pop().match(/(.+)\.(.+)/);return a&&(t=a[2]),t})(c)||"js";if(c=c.replace(new RegExp("\\."+g+"$"),""),b=l.indexOf("-r")>-1||/^.+:\/\//.test(c)?c:/^\./.test(c)?e.relative?c=e.relative+c:c.replace(/^\.\//,""):i.baseUrl+c,l.includes("-pack")){let e=b.match(/(.+)\/(.+)/);c=b=e&&2 in e?e[1]+"/"+e[2]+"/"+e[2]:`${b}/${b}`}/^.+:\/\//.test(b)||(b=m+b),b=b.replace(/\/\.\//,"/"),c=c.replace(/\/\.\//,"/"),/\.\.\//.test(b)&&(b=h(b),c=h(c));let w=u(b+="."+g),y=o?b+"?"+o:b;return Object.assign(e,{link:y,search:o,ori:c,fileType:g,path:b,dir:w,param:l}),e};const E=(e,t)=>{let a=c();return e.map((e,r)=>I({loadId:c(),id:r,str:e,groupId:a,relative:t}))};t.set("file",e=>{}),y("define",async(e,t)=>{let a={},r={exports:a};if(d(t)){let{path:s,dir:n}=e;t=t((...e)=>v(E(e,n)),a,r,{FILE:s,DIR:n})}return t instanceof Promise&&(t=await t),t||(e=>!(0 in Object.keys(e)))(r.exports)||(t=r.exports),async()=>t}),y("task",(e,t)=>{if(!d(t))throw"task must be a function";let{path:a,dir:r}=e;return async e=>{return await t((...e)=>v(E(e,r)),e.data,{FILE:a,DIR:r})}}),y("init",(e,t)=>{if(!d(t))throw"init must be a function";let a,{path:r,dir:s}=e,n=0;return async e=>n?a:(a=await t((...e)=>v(E(e,s)),e.data,{FILE:r,DIR:s}),n=1,a)});let j={get agent(){return w},get load(){return v},get fixUrlObj(){return I},get toUrlObjs(){return E},get setProcessor(){return y}};Object.defineProperty(i,"main",{value:j}),e.load||(e.load=k.load);let x=document.currentScript;if(!x&&(x=document.querySelector(["drill-cache"])),x){let e=x.getAttribute("drill-cache");e&&(k.cacheInfo.v=e)}let P=e.drill;Object.defineProperty(e,"drill",{get:()=>k,set(e){d(e)?p(()=>e(k)):console.error("drill type error =>",e)}}),P&&p(()=>P(k))})(window);