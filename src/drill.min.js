(e=>{"use strict";let t={},r={},a={},s={},l={},i={loadNum:2,time:2e3},o={paths:t,dirpaths:r,baseUrl:"",bag:a,tempM:{}};e.baseResources=o;const n=(()=>{let e=!1,t=[];return r=>(e||(e=!0,setTimeout(()=>{for(let e=0;e<t.length;e++)t[e]();t=[],e=!1},0)),t.push(r),r)})();const c=e=>new Promise(e),p=(e,t)=>e.forEach(t),{assign:d,defineProperty:h,keys:u}=Object;var m=Object.prototype.toString,f=e=>(e=>m.call(e).toLowerCase().replace(/(\[object )|(])/g,""))(e).search("function")>-1;class y{constructor(e){d(this,{tobe:[],fileType:e,get:async()=>{},_sl:[]});let t=2;h(this,"stat",{set(e){p(this._sl,t=>t(e,this._stat)),t=e},get:()=>t})}statChange(e){this._sl.push(e)}}const g=e=>{let t=e.split(/\s/).filter(e=>e&&e),r=t[0],a=r.match(/(.+)\?(\S+)$/)||"";a&&(r=a[1],a=a[2]);let{k:s,v:l}=x.cacheInfo;s&&l&&(a&&(a+="&"),a+=s+"="+l);let{loadNum:o}=i,n=i.time;return{str:e,ori:r,search:a,param:t.slice(1),loadNum:o,errLoadTime:n,hand:{rid:Math.random().toString(32).substr(2)}}},b=e=>{let{ori:a}=e,l=t[a];if(l)a=l;else for(let e in r){let t=r[e],s=t.r;if(s.test(a)){a=a.replace(s,t.v);break}}let i=(e=>{let t,r=e.split("/").pop().match(/(.+)\.(.+)/);return r&&(t=r[2]),t})(a);i&&s[i]||(i="js"),e.fileType=i;let n=a=a.replace(new RegExp("\\."+i+"$"),"");return e.param.indexOf("-r")>-1||(n=e.rel&&/^\./.test(n)?e.rel+n:o.baseUrl+n),n=n.replace(/\/\.\//,"/"),/\.\.\//.test(n)&&(n=(e=>{let t=e.split(/\//g),r=[];return p(t,e=>{".."==e&&r.length&&".."!=r.slice(-1)[0]?r.pop():r.push(e)}),r.join("/")})(n)),n+="."+e.fileType,e.path=n,e.dir=(e=>{let t=e.match(/(.+\/).+/);return t&&t[1]})(n),e},w=e=>c((t,r)=>{let{path:s}=e,l=a[s];if(!l){l=a[s]=new y(e.fileType);let{loadNum:t}=e,r=()=>{T(e).then(a=>{if(d(l,a.o),1==a.stat)l.stat=1,p(l.tobe,e=>{e.res()});else{if(t)return l.stat=4,t--,void setTimeout(()=>{r()},e.errLoadTime);l.stat=a.stat,p(l.tobe,e=>{console.error(a.stat+" "+a.msg),e.rej()}),r=null}delete l.tobe})};r()}switch(l.stat){case 1:l.get(e).then(t);break;case 2:case 3:case 4:l.tobe.push({res(){l.get(e).then(t)},rej:r})}}),T=async e=>{let t,{fileType:r}=e;return t="js"===r?await j(e):s[r]?await s[r](e):{stat:100,msg:"no this fileType => ."+e.fileType}},j=async e=>{let t=await v(e),{tempM:r}=o,{type:s}=r;if(s){t.o.jsType=s,a[e.path].stat=3;let r;switch(s){case"define":r=await I(e);break;case"task":r=await E(e);break;default:let t=l[s];t&&(r=await t(e))}d(t.o,r)}else t.o.jsType="file";return t},v=e=>c(t=>{let{path:r,search:a}=e;a&&(r=r+"?"+a);let s=document.createElement("script");s.type="text/javascript",s.async=!0,r&&(s.src=r),s.addEventListener("load",()=>{t({stat:1,o:{script:s}})}),s.addEventListener("error",r=>{document.head.removeChild(s),t({stat:404,msg:"load js file error => "+e.path,o:{}})}),n(()=>{document.head.appendChild(s)})});let k=(e,t)=>(...r)=>M(r.map(r=>(r=g(r),r.rel=e,r.parHand=t,b(r))));const I=async e=>{let{d:t}=o.tempM;o.tempM={};let r={},a={exports:r};if(f(t)){let{dir:s,hand:l,path:i}=e;t=t(k(s,l),r,a,{FILE:i,DIR:s})}return t instanceof Promise&&(t=await t),t||(e=>!(0 in u(e)))(a.exports)||(t=a.exports),{get:async()=>t}},E=async e=>{let{tempM:t}=o,{d:r}=t;if(!f(r))throw"drill's task must be a function";return o.tempM={},{get:async e=>{let{dir:t,hand:a,path:s,data:l}=e,i=r(k(t,a),l,{FILE:s,DIR:t});return await i}}},M=e=>{let t,r=c((r,a)=>{n(()=>{let s=e.length,l=s;switch(s){case 0:throw"no resource path";case 1:w(e[0]).then(e=>{t&&t({id:0,sum:l,stat:1}),r(e)}).catch(e=>{a()});break;default:let i=[],o=[];p(e,async(e,n)=>{let c=1,p=await w(e).catch(()=>{o.push(n),c=0});i[n]=p,t&&t({id:n,sum:l,stat:c}),--s||(0 in o?a({errors:o,result:i}):r(i))})}})});return r.post=(t=>(p(e,e=>{e.data=t}),r)),r.pend=(e=>(t=e,r)),r};let x={require:(...e)=>M(e.map(e=>b(g(e)))),loaders:s,processor:l,errInfo:i,config(e){o.baseUrl=e.baseUrl||o.baseUrl;let a=e.paths;for(let e in a)/\/$/.test(e)?r[e]={r:new RegExp("^"+e),v:a[e]}:t[e]=a[e]},cacheInfo:{k:"d_ver"},remove(){}};p(["define","task"],t=>{let r=x[t]=((e,r)=>{o.tempM={type:t,d:e,moduleId:r}});e[t]||(e[t]=r)});let L=document.currentScript;if(!L&&(L=document.querySelector(["drill-cache"])),L){let e=L.getAttribute("drill-cache");e&&(x.cacheInfo.v=e)}e.require||(e.require=x.require);let q=e.drill;q&&q(x),h(e,"drill",{get:()=>x,set(e){f(e)?e(x):console.error("drill type error =>",e)}})})(window);